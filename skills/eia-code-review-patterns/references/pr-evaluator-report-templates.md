# PR Evaluator Report Templates

This document contains template examples for PR evaluation reports generated by the pr-evaluator agent.

## Table of Contents

- Example Evaluation Report
  - Executive Summary
  - Detailed Findings
  - Impact Assessment
  - Recommendation
  - Appendices
- Output Formats
  - Markdown Report
  - Structured JSON
  - GitHub Comment Format

---

## Example Evaluation Report

### Executive Summary

**Overall Verdict:** REQUEST CHANGES

**Quick Stats:**
- Tests: 142/150 passed (94.7%)
- Build: Success
- Linting: 3 issues
- Type Checking: No errors
- Security: No findings
- Coverage: 87.3% (+2.1% from base)

### Detailed Findings

#### Test Results

**Passed (142 tests)**
- All unit tests in `tests/unit/` (85 tests)
- Integration tests in `tests/integration/api/` (42 tests)
- End-to-end tests in `tests/e2e/` (15 tests)

**Failed (8 tests)**

1. **test_user_authentication_with_expired_token**
   - Location: `tests/integration/auth/test_token_validation.py::test_user_authentication_with_expired_token`
   - Expected: 401 Unauthorized
   - Actual: 500 Internal Server Error
   - Error: `AssertionError: Expected status 401 but got 500`
   - Stack trace: [see appendix A]

2. **test_refresh_token_rotation**
   - Location: `tests/integration/auth/test_token_validation.py::test_refresh_token_rotation`
   - Expected: New refresh token in response
   - Actual: `KeyError: 'refresh_token'`
   - Error: Response missing required field
   - Stack trace: [see appendix B]

[... document all failures with same detail level ...]

#### Build Verification

**Build Status:** SUCCESS
- Duration: 2m 34s
- Output: Clean build with no warnings
- Artifacts: Successfully generated wheel and sdist

#### Linting Issues

**3 issues found**

1. **Line too long**
   - File: `src/auth/token_manager.py:145`
   - Issue: Line length 125 exceeds limit of 88
   - Severity: Low

2. **Unused import**
   - File: `src/auth/validators.py:3`
   - Issue: `from typing import Optional` imported but unused
   - Severity: Low

3. **Missing docstring**
   - File: `src/auth/middleware.py:78`
   - Issue: Function `_validate_signature` missing docstring
   - Severity: Medium

#### Type Checking

**No type errors found**
- mypy completed successfully
- All type hints valid

#### Security Scan

**No security issues found**
- TruffleHog scan clean
- No secrets detected
- No high-risk patterns

#### Code Coverage

**Coverage: 87.3%**
- Base branch coverage: 85.2%
- Change: +2.1%
- Newly added code coverage: 92.1%

**Uncovered areas:**
- `src/auth/token_manager.py`: Lines 234-245 (error handling branch)
- `src/auth/middleware.py`: Lines 89-93 (edge case in signature validation)

### Impact Assessment

#### Changes Introduced
- 8 new files added
- 12 files modified
- 3 files deleted
- Net: +487 lines, -234 lines

#### Risk Level: MEDIUM
- Authentication system changes carry security implications
- 8 failing tests indicate incomplete implementation
- Changes affect critical user-facing functionality

#### Blocking Issues
1. **Failed Tests (8)**: Must be resolved before merge
2. **Linting Issues (3)**: Should be fixed for code quality

#### Non-Blocking Observations
- Coverage increase is positive
- Build succeeds cleanly
- No security concerns detected

### Recommendation

**REQUEST CHANGES**

**Rationale:**
This PR introduces valuable authentication improvements but has 8 failing tests that must be resolved. The tests indicate issues with:
1. Expired token handling (returning 500 instead of 401)
2. Refresh token rotation (missing expected fields)
3. Edge cases in token validation

**Required Actions Before Approval:**
1. Fix all 8 failing tests
2. Resolve linting issues (line length, unused import, missing docstring)
3. Re-run full test suite to verify fixes

**Optional Improvements:**
1. Add tests for uncovered error handling branches
2. Consider adding integration tests for token edge cases

**Fix Scope:** 8 test files + 3 source files requiring changes

### Appendices

#### Appendix A: test_user_authentication_with_expired_token Stack Trace

```
tests/integration/auth/test_token_validation.py:145: in test_user_authentication_with_expired_token
    assert response.status_code == 401
E   AssertionError: assert 500 == 401
E    +  where 500 = <Response [500]>.status_code

During handling of the above exception, another exception occurred:
...
[full stack trace]
```

#### Appendix B: test_refresh_token_rotation Stack Trace

```
tests/integration/auth/test_token_validation.py:178: in test_refresh_token_rotation
    new_refresh_token = response.json()['refresh_token']
E   KeyError: 'refresh_token'

Response body: {"access_token": "...", "token_type": "bearer"}
Expected: {"access_token": "...", "refresh_token": "...", "token_type": "bearer"}
```

---

## Output Formats

### 1. Markdown Report

**Filename:** `pr-evaluation-report-${PR_NUMBER}.md`

**Sections:**
1. Executive Summary (verdict + quick stats)
2. Detailed Findings (test results, failures, build status)
3. Impact Assessment (risk level, changes introduced)
4. Recommendation (approve/request changes/reject)
5. Appendices (logs, traces, reports)

### 2. Structured JSON

**Filename:** `pr-evaluation-${PR_NUMBER}.json`

Contains all metrics, findings, and recommendations in machine-readable format:

```json
{
  "pr_number": 123,
  "evaluated_at": "2025-12-30T15:07:00Z",
  "verdict": "REQUEST_CHANGES",
  "metrics": {
    "tests": {"passed": 142, "failed": 8, "total": 150, "rate": 0.947},
    "build": {"status": "SUCCESS", "duration_seconds": 154},
    "linting": {"issues": 3, "errors": 0, "warnings": 3},
    "type_checking": {"errors": 0},
    "security": {"findings": 0},
    "coverage": {"current": 87.3, "base": 85.2, "change": 2.1}
  },
  "blocking_issues": [
    {"type": "test_failure", "count": 8, "description": "Authentication edge cases"},
    {"type": "lint_issue", "count": 3, "description": "Line length, unused import, missing docstring"}
  ],
  "recommendation": {
    "action": "REQUEST_CHANGES",
    "required": ["Fix 8 failing tests", "Resolve 3 linting issues"],
    "optional": ["Add tests for error handling branches"]
  }
}
```

### 3. GitHub Comment Format

For posting as PR comment:

```markdown
## PR Evaluation Report

**Evaluated at:** 2025-12-30 15:07 UTC

### Quick Stats
| Metric | Result |
|--------|--------|
| Tests | 142/150 passed (94.7%) |
| Build | Success |
| Linting | 3 issues |
| Type Check | No errors |
| Security | No findings |
| Coverage | 87.3% (+2.1%) |

### Verdict: REQUEST CHANGES

**Blocking Issues:**
- 8 tests failing (authentication edge cases)
- 3 linting issues

**Details:** See full evaluation report at `pr-evaluation-report-123.md`

**Fix scope:** 8 test files + 3 source files

---
<details>
<summary>Failed Tests (8)</summary>

1. `test_user_authentication_with_expired_token` - Returns 500 instead of 401
2. `test_refresh_token_rotation` - Missing refresh_token in response
3. [...]

</details>

<details>
<summary>Linting Issues (3)</summary>

1. `src/auth/token_manager.py:145` - Line too long (125 > 88)
2. `src/auth/validators.py:3` - Unused import: Optional
3. `src/auth/middleware.py:78` - Missing docstring

</details>
```
