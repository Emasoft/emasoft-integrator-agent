# =============================================================================
# Dependabot Configuration (Generic Template)
# =============================================================================
#
# WHAT: Configures Dependabot to automatically create pull requests when
#       dependencies have new versions available. Covers Python (pip),
#       JavaScript/TypeScript (npm), and GitHub Actions ecosystems.
#
# KEY PATTERNS DEMONSTRATED:
#   - Multi-ecosystem dependency updates (pip, npm, GitHub Actions)
#   - Weekly schedule (balances freshness vs PR noise)
#   - Grouped updates to reduce PR count (minor+patch in one PR)
#   - Conventional commit prefixes for automated changelog generation
#   - Labels for filtering and routing dependency PRs
#   - Reviewer assignment for accountability
#   - Open PR limits to prevent PR floods
#   - Ignore patterns for dependencies you want to manage manually
#
# HOW TO CUSTOMIZE:
#   - Adjust directory paths to match your project structure
#   - Change schedule interval (daily/weekly/monthly)
#   - Add/remove ecosystems (pip, npm, cargo, gomod, docker, etc.)
#   - Configure reviewers and assignees for your team
#   - Add groups for related dependencies that should update together
#   - Add ignore patterns for dependencies with breaking changes
#
# REFERENCE: eia-ci-failure-patterns/references/dependency-management.md
#
# FILE LOCATION: This file goes in .github/dependabot.yml (NOT in workflows/)
# =============================================================================

version: 2
updates:

  # ---------------------------------------------------------------------------
  # Python Dependencies (pip)
  # ---------------------------------------------------------------------------
  # WHY: Python packages often have security patches. Weekly checks ensure
  # you get security fixes within a week of release.
  - package-ecosystem: pip
    # CUSTOMIZE: Change to your Python project root (where requirements.txt
    # or pyproject.toml lives)
    directory: /src/backend
    schedule:
      # WHY weekly: Daily creates too many PRs. Monthly risks missing
      # critical security patches. Weekly is the sweet spot.
      interval: weekly
      # WHY specify day: Ensures PRs arrive at a predictable time.
      # Monday morning gives the team a full week to review.
      day: monday
    # WHY limit: Prevents Dependabot from flooding the repo with PRs.
    # 5 concurrent PRs is manageable for most teams.
    open-pull-requests-limit: 5
    # WHY labels: Enables filtering dependency PRs in GitHub search/projects.
    # Also useful for auto-merge rules (e.g., auto-merge patch updates).
    labels:
      - dependencies
      - python
    # WHY prefix: Conventional commit format enables automated changelogs
    # and makes dependency updates easy to identify in git log.
    commit-message:
      prefix: "chore(deps)"
    # WHY reviewers: Ensures someone is accountable for reviewing updates.
    # CUSTOMIZE: Replace with your team members' GitHub usernames.
    reviewers:
      - your-team/backend-reviewers
    # WHY groups: Related packages often need to update together.
    # Grouping reduces PR count and avoids version incompatibilities.
    groups:
      # Group all minor and patch updates into a single PR
      python-minor-patch:
        update-types:
          - minor
          - patch
    # WHY ignore: Some dependencies have frequent breaking changes or
    # require manual migration. Manage these separately.
    # CUSTOMIZE: Add dependencies that need manual update attention.
    # ignore:
    #   - dependency-name: "some-package"
    #     update-types: ["version-update:semver-major"]

  # ---------------------------------------------------------------------------
  # JavaScript/TypeScript Dependencies (npm)
  # ---------------------------------------------------------------------------
  # WHY: npm ecosystem has frequent updates. Weekly checks keep the
  # frontend stack current without overwhelming the team.
  - package-ecosystem: npm
    # CUSTOMIZE: Change to your JavaScript/TypeScript project root
    # (where package.json lives)
    directory: /src/frontend
    schedule:
      interval: weekly
      day: monday
    open-pull-requests-limit: 5
    labels:
      - dependencies
      - javascript
    commit-message:
      prefix: "chore(deps)"
    reviewers:
      - your-team/frontend-reviewers
    groups:
      # Group all minor and patch updates into a single PR
      npm-minor-patch:
        update-types:
          - minor
          - patch
      # Group TypeScript-related packages together since they often
      # need compatible versions
      typescript-tools:
        patterns:
          - "typescript"
          - "@types/*"
          - "ts-*"

  # ---------------------------------------------------------------------------
  # GitHub Actions Dependencies
  # ---------------------------------------------------------------------------
  # WHY: Actions can have security vulnerabilities too. Pinning to specific
  # versions (e.g., actions/checkout@v4) means you miss patches unless
  # Dependabot updates them.
  - package-ecosystem: github-actions
    # WHY root: GitHub Actions workflows live in .github/workflows/ but
    # Dependabot needs the root directory to find them.
    directory: /
    schedule:
      interval: weekly
      day: monday
    open-pull-requests-limit: 5
    labels:
      - dependencies
      - ci
    # WHY different prefix: Distinguishes CI dependency updates from
    # application dependency updates in the commit history.
    commit-message:
      prefix: "ci(deps)"
    groups:
      # Group all GitHub Actions updates together since they rarely conflict
      actions-all:
        patterns:
          - "*"
